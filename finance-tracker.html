<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Tracker</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lodash@4.17.21/lodash.min.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700;800&display=swap');
        body { margin: 0; padding: 0; background: #0C1220; color: #E2E8F0; font-family: 'DM Sans', sans-serif; }
        .container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
        .card { background: #111D2E; border: 1px solid #1B2A3D; border-radius: 12px; padding: 20px; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #0C1220; border: 1px solid #1B2A3D; color: white; border-radius: 8px; }
        button { width: 100%; padding: 12px; background: #339AF0; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Ensure we grab libraries from the global window object
        const { useState, useEffect, useMemo } = React;
        const { PieChart, Pie, Cell, ResponsiveContainer, Tooltip } = Recharts;

        const CAT_CFG = {
            Dining: { col: "#FF6B6B", ico: "ðŸ½ï¸" },
            Groceries: { col: "#51CF66", ico: "ðŸ›’" },
            Others: { col: "#868E96", ico: "ðŸ“¦" }
        };

        // FIXED: Removed ?. to support older Babel versions
        const gc = (c) => (CAT_CFG[c] && CAT_CFG[c].col) ? CAT_CFG[c].col : "#868E96";
        const gi = (c) => (CAT_CFG[c] && CAT_CFG[c].ico) ? CAT_CFG[c].ico : "â€¢";

        function App() {
            const [sid, setSid] = useState(localStorage.getItem("ft_sid") || "");
            const [apiKey, setApiKey] = useState(localStorage.getItem("ft_key") || "");
            const [isSetup, setIsSetup] = useState(!localStorage.getItem("ft_sid"));

            const handleSave = () => {
                localStorage.setItem("ft_sid", sid);
                localStorage.setItem("ft_key", apiKey);
                setIsSetup(false);
            };

            if (isSetup) {
                return (
                    <div className="container">
                        <div className="card">
                            <h2>Setup Finance Tracker</h2>
                            <input placeholder="Google Sheet ID" value={sid} onChange={e => setSid(e.target.value)} />
                            <input placeholder="API Key" type="password" value={apiKey} onChange={e => setApiKey(e.target.value)} />
                            <button onClick={handleSave}>Connect</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="container">
                    <h1>Finance Tracker Live</h1>
                    <div className="card">
                        <p>Connected to Sheet: {sid.substring(0, 5)}...</p>
                        <button onClick={() => setIsSetup(true)}>Change Settings</button>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
